ğŸ“„ NFe Processor - Sistema de Processamento de Notas Fiscais EletrÃ´nicas

Sistema Spring Boot para processamento automÃ¡tico de arquivos XML de Notas Fiscais EletrÃ´nicas (NFE) via FTP e persistÃªncia em banco de dados Oracle.

ğŸš€ Funcionalidades

ğŸ“¥ Download automÃ¡tico de arquivos XML de servidor FTP
ğŸ” Processamento e parsing de dados de NFe
ğŸ’¾ PersistÃªncia em banco de dados Oracle
ğŸ“ MovimentaÃ§Ã£o automÃ¡tica de arquivos processados
â° Agendamento de processamento a cada 60 segundos
âŒ Tratamento de erros com movimentaÃ§Ã£o para pasta de erro
ğŸ› ï¸ Tecnologias

Java 19
Spring Boot 3.5.7
Spring Data JPA
Oracle Database
Apache Commons Net (FTP Client)
Lombok
Maven
ğŸ“‹ PrÃ©-requisitos

Java 19 ou superior
Maven 3.6+
Banco Oracle 11g+
Servidor FTP compatÃ­vel
âš™ï¸ ConfiguraÃ§Ã£o

1. Clone o projeto
> git clone <url-do-repositorio>
   cd nfe-processor

2. ConfiguraÃ§Ã£o do Banco de Dados

Edite src/main/resources/application.properties:
>
# Database
>spring.datasource.url=jdbc:oracle:thin:@host:port/SID
spring.datasource.username=seu_usuario
spring.datasource.password=sua_senha

# FTP
>ftp.host=seu_host_ftp
ftp.port=21
ftp.username=usuario_ftp
ftp.password=senha_ftp
ftp.xmls-dir=/nfs

3. Estrutura de DiretÃ³rios FTP

Crie no servidor FTP:
/nfs/
â”œâ”€â”€ processed/     # Arquivos processados com sucesso
â””â”€â”€ error/         # Arquivos com erro no processamento

ğŸ—ƒï¸ Estrutura do Banco

Tabela Principal: NF_NFITEM_NFANEXO_XMLFS

Principais campos mapeados:

NR_NOTA_FISCAL - NÃºmero da nota fiscal
CD_SERIE_NF - SÃ©rie da nota
CD_CGC_EMITENTE - CNPJ do emitente
DT_EMISSAO - Data de emissÃ£o
VL_TOTAL_NOTA - Valor total da nota
DS_XML_COMPL - XML completo (atÃ© 4000 caracteres)
DS_LINK_XML - Nome do arquivo original
ğŸš€ ExecuÃ§Ã£o

Desenvolvimento
>mvn spring-boot:run
 
ProduÃ§Ã£o
>mvn clean package
java -jar target/nf-0.0.1-SNAPSHOT.jar

ğŸ“Š Logs e Monitoramento

Os logs mostram o processo em tempo real:
ğŸš€ MÃ‰TODO AGENDADO EXECUTADO - Verificando XMLs...
ğŸ“ Iniciando verificaÃ§Ã£o de XMLs no diretÃ³rio: /nfs
ğŸ“Š Total de arquivos encontrados: 3
ğŸ”„ Processando arquivo: nota_fiscal.xml
âœ… Nota fiscal 12345 processada com sucesso
âœ… XML nota_fiscal.xml processado e movido com sucesso

âš ï¸ SoluÃ§Ã£o de Problemas

Erro: "NÃ£o Ã© possÃ­vel inserir NULL"

Causa: Campos obrigatÃ³rios nÃ£o preenchidos
SoluÃ§Ã£o: Verificar mapeamento no XmlProcessingService

Erro: "DiretÃ³rio nÃ£o encontrado"

Causa: Caminho FTP incorreto
SoluÃ§Ã£o: Verificar ftp.xmls-dir no application.properties

Arquivos nÃ£o sÃ£o processados

Causa: ExtensÃ£o diferente de .xml
SoluÃ§Ã£o: Certificar que arquivos terminam com .xml

ğŸ”§ CustomizaÃ§Ã£o

Alterar Intervalo de Processamento

Edite application.properties:
>file.processing.delay=30000  # 30 segundos

Adicionar Novos Campos

Adicione campo na entidade NfXmlEntity
Atualize mapeamento no XmlProcessingService
Execute mvn clean compile
ğŸ“ Estrutura do Projeto
src/
â”œâ”€â”€ main/
â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â””â”€â”€ financeiro/
â”‚   â”‚       â””â”€â”€ nf/
â”‚   â”‚           â”œâ”€â”€ NfApplication.java
â”‚   â”‚           â”œâ”€â”€ entity/
â”‚   â”‚           â”‚   â””â”€â”€ NfXmlEntity.java
â”‚   â”‚           â”œâ”€â”€ repository/
â”‚   â”‚           â”‚   â””â”€â”€ NfXmlRepository.java
â”‚   â”‚           â””â”€â”€ services/
â”‚   â”‚               â”œâ”€â”€ FtpService.java
â”‚   â”‚               â”œâ”€â”€ XmlProcessingService.java
â”‚   â”‚               â””â”€â”€ NfeProcessingService.java
â”‚   â””â”€â”€ resources/
â”‚       â””â”€â”€ application.properties
â””â”€â”€ pom.xml

ğŸ‘¥ Desenvolvimento

Adicionando Novas Funcionalidades

Crie testes unitÃ¡rios para novas features
Atualize documentaÃ§Ã£o
Execute mvn clean test antes do commit
PadrÃµes de CÃ³digo

Use Lombok para getters/setters
Logs em portuguÃªs com emojis para melhor visualizaÃ§Ã£o
Tratamento de exceptions especÃ­fico
ğŸ“ Suporte

Para issues e dÃºvidas:

Verifique os logs da aplicaÃ§Ã£o
Confirme configuraÃ§Ãµes do FTP e banco
Verifique permissÃµes de diretÃ³rio
ğŸ“„ LicenÃ§a

Este projeto Ã© para uso interno.